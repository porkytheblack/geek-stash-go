FROM golang:1.16-alpine 

RUN adduser --disabled-password --gecos "" runner \
    && usermod -aG sudo runner \
    && chown -R runner:runner /app

WORKDIR /app

USER runner

COPY . .

ENV AUTH0_SECRET=${AUTH0_SECRET}
ENV AUTH0_BASE_URL=${AUTH0_BASE_URL}
ENV AUTH0_ISSUER_BASE_URL=${AUTH0_ISSUER_BASE_URL}
ENV AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ENV AUTH0_CLIENT_SECRET=${AUTH0_CLIENT_SECRET}
ENV XAUTHKEY=${XAUTHKEY}
ENV DB_HOST=${DB_HOST}
ENV DB_PORT=${DB_PORT}
ENV DB_USER=${DB_USER}
ENV DB_PASS=${DB_PASS}
ENV DB_NAME=${DB_NAME}
ENV DB_SSLMODE=${DB_SSLMODE}
ENV GO_ENV=${GO_ENV}


RUN go build -o main

CMD ["./main"]