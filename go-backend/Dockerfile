FROM golang:1.20.1-bullseye

WORKDIR /app




ARG AUTH0_SECRET
ENV AUTH0_SECRET=${AUTH0_SECRET}
ARG AUTH0_BASE_URL
ENV AUTH0_BASE_URL=${AUTH0_BASE_URL}
ARG AUTH0_ISSUER_BASE_URL
ENV AUTH0_ISSUER_BASE_URL=${AUTH0_ISSUER_BASE_URL}
ARG AUTH0_CLIENT_ID
ENV AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ARG AUTH0_CLIENT_SECRET
ENV AUTH0_CLIENT_SECRET=${AUTH0_CLIENT_SECRET}
ARG XAUTHKEY
ENV XAUTHKEY=${XAUTHKEY}
ARG DB_HOST
ENV DB_HOST=${DB_HOST}
ARG DB_PORT
ENV DB_PORT=${DB_PORT}
ARG DB_USER
ENV DB_USER=${DB_USER}
ARG DB_PASS
ENV DB_PASS=${DB_PASS}
ARG DB_NAME
ENV DB_NAME=${DB_NAME}
ARG DB_SSLMODE
ENV DB_SSLMODE=${DB_SSLMODE}
ARG GO_ENV
ENV GO_ENV=${GO_ENV}

RUN echo " stuff:: ${AUTH0_BASE_URL} ${AUTH0_ISSUER_BASE_URL} ${AUTH0_CLIENT_ID} ${AUTH0_CLIENT_SECRET} ${XAUTHKEY} ${DB_HOST} ${DB_PORT} ${DB_USER} ${DB_PASS} ${DB_NAME} ${DB_SSLMODE} ${GO_ENV} " 

COPY . ./

RUN ls -la

RUN go mod download


RUN go build -o main

RUN ls -la

CMD ["main"]